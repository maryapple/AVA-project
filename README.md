# AVA Веб-архив арктических экспедиций

## Описание
Проект представляет собой [сайт-архив](https://ava.auditory.ru/) для ИПЭ РАН. В нем содержится информация по местности (Российской Арктике).

## Оглавление
* [Описание](#Описание)
* [Оглавление](#Оглавление)
* [Начало работы](#Начало-работы)
    * [Google Account](#Google-Account)
    * [Содержимое Диска](#Содержимое-Диска)
* [Эксплуатация](#Эксплуатация)
    * [Google Spreadsheet](#Google-Spreadsheet)
    * [Google Site](#Google-Site)
    * [Google Docs](#Google-Docs)
    * [Google Forms](#Google-Forms)
    * [Распределение прав доступа](#Распределение-прав-доступа)

## Начало работы
### Google Account
Для начала требуется вход в аккаунт (указать его?) и открыть Диск

### Содержимое Диска
- AVA
    * Здесь находится сам сайт, таблица с данными, форма ввода данных, запроса на доступ к данным, и отдельная карта (она уже не нужна)
- AVA-test
    * Тестовая версия сайта
- Datasets
    * Здесь лежат папки с Датасетами
- Docs to Datasets
    * Папка, куда сохраняются сгенерированные гуглодокументы
- Photos
    * Сюда были загружены фото на первом этапе разработки

## Эксплуатация
### Google Spreadsheet
Скриптам внутри таблицы соответствует sshet-scripts из этого репозитория

1. Просмотр кода: Меню -> Инструменты -> Редактор скриптов
2. Лист Map содержит данные, которые преобразовываются в JSON. 
Нельзя заполнять лишние ячейки!
3. Просмотр ошибок выполнения скрипта: Меню -> Вид -> Выполнения
4. [config](https://github.com/maryapple/AVA-project/tree/master/config) - файл appscript.json, содержит настройки доступов к сервисам Google для работы со скриптом

**Триггеры**
В таблице есть 2 триггера:
1. Первый действует по событию onSubmit из формы Input Data
2. Второй триггер - временной триггер, который срабатывает каждый 2 часа (проверяет ответы из Request Access)
С ограничениями триггеров можно ознакомиться [здесь](https://developers.google.com/apps-script/guides/services/quotas)

### Google Site
Сайт содержит главную страницу, в которую встроен HTML-код из файла index.html
В качестве API с данными используется лист таблицы, преобразованный по ссылке в JSON

### Google Forms
С помощью Input Data осуществляется ввод данных датасета, Request Access - запрос на скачивание датасета

### Google Docs
При добавлении точки из скрипта создается документ, включающие в себя информацию из таблицы   

### Распределение прав доступа
Второй лист таблицы - лист, на который приходят ответы из формы Request Access. В зависимости от ответа в столбце E автоматически предоставляется доступ. Скринт, который работает с доступом - guests.js
Кроме этого, в форме Request Access используется дополнение Email Notifications For Forms. Алгоритм работы такой:
1. Пользователь отвечает на форму
2. Администратору на почту приходит письмо-извещение о том, что записан ответ на форму
3. Администратор открывает лист таблицы Guests
4. Администратор в зависимости от решения ставит отметку 'y' - если оно положительное в столбец E
5. Гостю приходит оповещение на почту. Если почта пользователя gmail, то он может пользоваться ссылкой на скачивание из документа, если почта не gmail, то ему приходит ссылка на скачивание в письме (и в то же время ссылка из Google Doc не является актуальной для его почты)